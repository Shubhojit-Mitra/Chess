"use strict";
var express = require("express");
var http = require('http');
var cookieParser = require('cookie-parser');
var errorCodes_1 = require("./server/errorCodes");
var path = require('path');
var open = require('open');
var serverStarted = require('./server/serverStarted');
var cl = require('./server/commandLine');
var publicPath = path.resolve(__dirname, 'public');
var app = express();
var server = http.createServer(app);
app.use(cookieParser());
var devtime_1 = require('./server/devtime');
devtime_1.setup(app);
app.use(express.static(publicPath, {}));
var socketServer_1 = require("./socket/socketServer");
socketServer_1.register(server);
var clOptions = cl.getOptions();
var portfinder = require('portfinder');
portfinder.basePort = clOptions.port;
portfinder.getPort(function (err, port) {
    if (err) {
        console.error(err);
        errorCodes_1.exit(errorCodes_1.errorCodes.couldNotListen);
    }
    server.listen(port, function (err) {
        if (err) {
            console.error(err);
            errorCodes_1.exit(errorCodes_1.errorCodes.couldNotListen);
        }
        console.log("Dashboard at http://localhost:" + port);
        if (clOptions.open) {
            open("http://localhost:" + port);
        }
        serverStarted.started();
    });
});
var pkg = require('../package.json');
require('update-notifier')({
    pkg: pkg,
}).notify();
